!function(e,t){"function"==typeof define&&define.amd?define([],t):"undefined"!=typeof module&&module.exports?module.exports=t():e.OfflineModel=t()}(this,function(){"use strict";var e={secret:"",storageType:"localStorage",init:function(e){Object.assign(this,e)},encrypt:function(e){var t=JSON.stringify(e);return t},decrypt:function(e){var t=JSON.parse(e),r=new Date(t.expiry);return!t.expiry||r.getTime()>=Date.now()?t.data:null},get:function(e){var t=window[this.storageType].getItem(e);return t&&this.decrypt(t)},set:function(e,t,r){if(!t)return this.remove(e),!1;var i=null;if(r){var n=Date.now();n+=r,i=new Date(n).getTime()}var s={data:t,expiry:i},u=this.encrypt(s);return window[this.storageType].setItem(e,u),!0},remove:function(e){return window[this.storageType].removeItem(e),!0},clearAll:function(){return window[this.storageType].clear(),!0}};const t=function(e,t){return e.map(function(e){return e[t]}).reduce(function(e,t){return Math.max(e,t)},0)};var r=null,i="localStorage",n={primaryKey:"_id",fields:null,key:null,secret:"my-awesome-key",expiry:null,init:function(t,r){r=r||{},Object.assign(this,r),e.storageType=i,e.init({secret:this.secret});var n=e.get(this.key);return Array.isArray(n)&&(t=n),Array.isArray(this.fields)&&(t=this.createValueObjects(t)),e.set(this.key,t,this.expiry),this.setListItems(t),this},createValueObjects:function(e){var t=this;return e=e.map(function(e){return t.createValueObject(e)})},createValueObject:function(e){var t={};return this.fields.forEach(function(r){t[r]=e[r]||""}),t},setStorageType:function(e){return i=e,this},setKey:function(e){return this.key=e,this},getKey:function(){return this.key},setListItems:function(e){return r=e,this},getListItems:function(){var t=r;return this.expiry&&(t=e.get(this.key)),t||e.remove(this.key),t},setFields:function(e){return this.fields=e,this},countTotalItems:function(e){return t(e,this.primaryKey)+1},create:function(t){return t=this.createValueObject(t),t[this.primaryKey]=this.countTotalItems(r),r.push(t),e.set(this.key,r,this.expiry),r},update:function(t){var i=this;return r=r.map(function(e){return e[i.primaryKey]===t[i.primaryKey]&&(e=i.createValueObject(t)),e}),e.set(this.key,r,this.expiry),r},delete:function(t){var r=this.getListItems(),i=this,n=r.filter(function(e){return e[i.primaryKey]===t})[0];return n?(r=r.filter(function(e){return e[i.primaryKey]!==n[i.primaryKey]}),this.setListItems(r),e.set(this.key,r,this.expiry),n):!!n},clearAll:function(){return r=[],e.clearAll()}};return n});